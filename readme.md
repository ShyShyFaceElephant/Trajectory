# Trajectory：基於腦年齡與失智症預測模型之長期腦部健康追蹤系統

## 系統簡介

[![產品介紹影片：](images/demo.png)](https://youtu.be/9u6xG_67Q1s)

產品介紹影片：https://youtu.be/9u6xG_67Q1s

Trajectory是一套基於腦年齡與失智症預測模型的長期腦部健康追蹤系統，旨在滿足高齡化與少子化社會對精準醫療的需求。受試者之腦部 MRI 影像輸入至本系統後，腦齡預測模型會提供腦齡值作為腦部健康狀態的量化指標。本系統適用於所有年齡層，不僅可作為兒童與青少年腦部成熟度的評估工具，亦能作為中老年族群認知退化的早期徵兆。

我們將本系統命名為「Trajectory」，意為「軌跡」。它不僅是單純的腦齡預測模型之圖形化介面，更是一個包含長期腦齡追蹤、AI失智症輔助診斷與關鍵腦區熱圖的完整系統。本系統透過折線圖呈現歷次腦齡紀錄，追蹤個人成長軌跡。一般使用者可調閱歷次 MRI 影像紀錄，並查看其分析結果（包括腦齡、AI 失智症診斷與關鍵腦區熱圖）；醫師則具有上傳、編輯與查看患者資料等更高層次的管理者權限。

---

## 應用場景

![系統應用場景](images/SystemApplicationScenarios.png)
圖1. Trajectory系統應用場景

本系統使用流程如下：

1. 受試者進行簡易智能狀態測驗（MMSE）（中低年齡群體不需參與）
2. 受試者拍攝腦部MRI影像
3. 資訊室人員將腦部MRI影像及認知測驗結果上傳至伺服器
4. 伺服器運行腦齡預測模型與失智症診斷模型
5. 伺服器將分析結果（包含：腦齡、AI失智症診斷、關鍵腦區熱圖）歸檔
6. 醫師調用受試者資料並結合自身專業知識做出最終診斷
7. 受試者在院內機台也可調閱分析結果與診斷紀錄

---

## 系統架構

![系統架構](images/SystemFramework.png)
圖2. Trajectory系統架構

本系統採前後端完全分離設計，目的是讓使用者在不同終端設備皆能使用相同API存取資料。

本系統欲在醫院中多種終端設備部屬，因此採用跨平台前端框架，考量到 MRI 影像涉及大量數據傳輸與顯示，故在我們多種跨平台前端框架中，選擇存取速度與偵率表現更卓越的Flutter。前端分為醫師介面與一般使用者介面，一般使用者介面提供使用者查閱歷次影像紀錄與腦部分析結果；醫師介面則提供管理者上傳影像、執行AI運算功能，並統一管理受試者。

由於本系統的 AI 模型以 Python 撰寫，為提升運算效率並簡化跨語言介面維護，我們選擇以同樣基於 Python 的 FastAPI 作為後端框架。後端由伺服器負責接受API請求，並溝通資料庫及AI模型模組，彼此獨立運行，確保系統安全穩定。

順帶一提，本系統除了提供使用者查看診斷結果外，希望能納入「健康指南」給予具體的治療或保健方針，但本團隊受限於專業知識，此功能暫時留在藍圖中。

---

## AI運算模組

![AI運算模組](images/AiModule.png)
圖3. Trajectory AI運算模組

圖3為本系統後端的AI運算模組之架構。首先，腦部 MRI 影像會經過前處理，處理後的影像隨後會被送入兩個平行的運算流程：

1. 腦齡預測：影像被輸入至 SFCN 模型並輸出腦齡預測值。此腦齡預測模型即為本專題於第四章所研發的成果。
2. 失智症分類：影像與其他輔助特徵（認知測驗分數、性別與年齡）一起輸入至 DenseNet 、 XGBoost 混合模型，輸出失智症分類結果。此失智症分類模型由本實驗室的前輩所研發。

最後，利用 Grad-CAM 演算法，根據模型輸出生成對應的關鍵腦區熱圖。

---

## Trajectory功能介紹

![登入介面](images/login.png)
圖4. 登入介面
圖4頁面提供兩種登入方式：受試者由 「一般登入」通道登入，而管理者則由 「醫師登入」通道登入。

![醫師介面—成員管理](images/memberManagement.png)
圖5. 醫師介面—成員管理
圖5頁面提供管理者一個列表，能查看所以有受試者，點選「選擇」按鈕跳轉至該受試者介面，調閱其腦部分析結果及歷次影像記錄。

![醫師介面—上傳影像](images/uploadImage.png)
圖6. 醫師介面—上傳影像
圖6頁面提供資訊室人員圖形化介面上傳檢測資料，上傳過程分為三步驟：

1. 依序填入身分證字號、拍攝日期、腦部MRI影像與認知測驗結果（中低年齡群體不需要填寫此欄位），點擊「建檔」，資料將傳遞至伺服器並在資料庫中初始化一筆影像紀錄，並自動填寫實際年齡。
2. 點擊「AI計算」，伺服器將根據資料庫中的資料運行腦齡預測模型與失智症診斷模型（若未填入認知測驗結果，則不會運行失智症診斷模型），運算結束後將結果自動填入相對應欄位中。
3. 點擊「儲存」，將預測結果更新置資料庫。

![醫師介面—新增成員](images/addMember.png)
圖7. 醫師介面—新增成員
圖7頁面提供管理者新增受試者的圖形化介面，依序填入姓名、身分證字號、出生日期、性別與個人照，點擊「送出」，便可快速建立一般使用者帳號。

![一般使用者介面—腦部分析](images/brainAnalysis.png)
圖8. 一般使用者介面—腦部分析
圖8頁面提供受試者（及管理者）查閱腦部分析結果，上方的窗格顯示最近一次AI失智症診斷結果，若未曾檢測則不顯示結果；下方的窗格則顯示歷次檢測的實際年齡與腦齡折線圖，受試者能直觀看見腦部發展軌跡。

![一般使用者介面—影像紀錄a](images/recordsA.png)
<div align="center">(a)</div>

![一般使用者介面—影像紀錄b](images/recordsB.png)
<div align="center">(b)</div>

圖9.一般使用者介面—影像紀錄
圖9頁面提供受試者（及管理者）查閱腦歷次影像紀錄細節，從上方的窗格（圖9(a)）可以選取欲查看的影像紀錄，點擊「選取」，則會在下方（圖9(b)）顯示該次MRI影像（可同時開啟多筆影像紀錄），使用者透果滑鼠滾輪可以檢視各方向腦部細節，勾選「顯示關鍵腦區」功能，MRI影像上會顯示其關鍵腦區熱圖輔助判讀。

---

## 開發團隊

| 成員     | 負責工作 |
|----------|--------------------------------------------------------------------------|
| 顏少于   | 主持 Trajectory 開發、前端設計、前後端整合、腦齡預測模型串接 |
| 王冠智   | 後端 API 設計、資料庫、整合 AI 模組、校外競賽文件 |
| 徐睿淳   | MRI 切片儲存、失智症分類模型串接、介紹影片製作、系統功能規劃   |
| 劉學諺   | 失智症分類模型開發 |